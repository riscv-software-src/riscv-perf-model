schema: 2

# ---------- Variables ----------
variables:
  workloads_roots:
    - "/workloads"
    - "/default"
  env_root: "/default/environment/{board}"
  outputs_root: "/outputs/{emulator}/bin"
  include_auto: []   # add any global include dirs here if you like
  alt_roots:
    # If a path starting with /workloads/... doesn't exist, try /default/...
    - { from: "/workloads/", to: "/default/" }

# ---------- Toolchains ----------
toolchains:
  rv32:
    baremetal:
      cc: riscv32-unknown-elf-gcc
      base_cflags: ["-march=rv32imafdc", "-mabi=ilp32d", "-mcmodel=medany", "-mno-relax", "-mstrict-align"]
      base_ldflags: ["-march=rv32imafdc", "-mabi=ilp32d", "-nostartfiles", "-Wl,--no-warn-rwx-segments"]
      libs: ["-lc", "-lm"]
      linker_script: "link.ld"

    linux:
      cc: riscv32-unknown-linux-gnu-gcc
      base_cflags: ["-march=rv32imafdc", "-mabi=ilp32d", "-static", "-O2"]
      base_ldflags: ["-march=rv32imafdc", "-mabi=ilp32d", "-static"]
      libs: ["-lm"]
      linker_script: null

  rv64:
    baremetal:
      cc: riscv64-unknown-elf-gcc
      base_cflags: ["-march=rv64imafdc", "-mabi=lp64d", "-mcmodel=medany", "-mno-relax", "-mstrict-align"]
      base_ldflags: ["-march=rv64imafdc", "-mabi=lp64d", "-nostartfiles", "-Wl,--no-warn-rwx-segments"]
      libs: ["-lc", "-lm"]
      linker_script: "link.ld"

    linux:
      cc: riscv64-linux-gnu-gcc
      base_cflags: ["-march=rv64imafdc", "-mabi=lp64d", "-static", "-O2"]
      base_ldflags: ["-march=rv64imafdc", "-mabi=lp64d", "-static"]
      libs: ["-lm"]
      linker_script: null

# ---------- Features ----------
features:
  bbv:
    cflags: ["-DBBV"]
    ldflags: []
  trace:
    cflags: ["-DTRACE"]
    ldflags: []

# ---------- Workloads ----------
workloads:

  embench-iot:
    # Pure YAML: structure, what to compile, where from.
    layout:
      mode: per_benchmark
      per_benchmark:
        bench_root: "{workload_root}/src"
        source_patterns: ["*.c"]
        exclude_dirs: []
      support_per_benchmark_patterns:
        - "{workload_root}/support/beebsc.c"
    includes:
      - "{workload_root}/support"
      - "{workload_root}/env"
    defines: ["CPU_MHZ=1", "WARMUP_HEAT=1", "true=1", "false=0"]
    cflags: []
    ldflags: []
    libs: []
    env:
      files: ["crt0.S", "main.c", "stub.c", "util.c"]
      skip: false

    platforms:
      linux:
        # Linux: usually no env / different flags. Adjust as you need.
        env: { skip: true, files: [] }
        cflags: ["-std=gnu99"]
        ldflags: []
        libs: ["-lm"]
        includes: []

  riscv-tests:
    layout:
      mode: per_benchmark
      per_benchmark:
        bench_root: "{workload_root}/benchmarks"
        source_patterns: ["*.c", "*.S"]
        exclude_dirs: ["common"]
      common_patterns:
        - "{workload_root}/benchmarks/common/*.c"
      common_skip: []   # e.g., ["syscalls.c"] on Linux if you need
    includes:
      - "{workload_root}/benchmarks/common"
      # add ISA sim env if needed:
      # - "/riscv/condor.riscv-isa-sim/riscv-tests/env"
      # - "/riscv/condor.riscv-isa-sim/riscv"
    defines: []
    cflags: ["-std=gnu99", "-Wno-implicit-int", "-Wno-implicit-function-declaration"]
    ldflags: []
    libs: []
    env:
      files: ["crt0.S", "main.c", "stub.c", "util.c"]
      skip: false

    platforms:
      linux:
        env: { skip: true }
        cflags: ["-std=gnu99"]
        # Often riscv-tests 'syscalls.c' conflicts under Linux; skip via common_skip:
        layout:
          common_skip: ["syscalls.c"]
